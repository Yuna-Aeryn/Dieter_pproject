app.post('/get-recommendation', async (req, res) => {
  try {
    const { gender, currentIntake, foodList } = req.body;
    if (!gender || !currentIntake) return res.status(400).json({ error: 'Missing data' });

    const standard = RECOMMENDED_INTAKE[gender];
    const user_state = {
      "rec_cal": standard.calories, "rec_carb": standard.carbs, "rec_pro": standard.protein,
      "rec_fat": standard.fat, "rec_sugar": standard.sugar, "rec_na": standard.sodium,
      "cur_cal": extractNumber(currentIntake.calories),
      "cur_carb": extractNumber(currentIntake.carbs),
      "cur_pro": extractNumber(currentIntake.protein),
      "cur_fat": extractNumber(currentIntake.fat),
      "cur_sugar": extractNumber(currentIntake.sugar),
      "cur_na": extractNumber(currentIntake.sodium)
    };

    console.log("ğŸ“¤ ì¶”ì²œ ìš”ì²­ ë³´ëƒ„ (Python)...");
    
    // íŒŒì´ì¬ ì„œë²„ í˜¸ì¶œ
    const response = await axios.post('${PYTHON_API_URL}/recommend', {
      user_state: user_state,
      recent_food_names: foodList || []
    });

    const recommendations = response.data;

    if (recommendations.length > 0) {
        const safeList = recommendations.map(item => ({
            menuName: item.recommend_menu,
            calories: extractNumber(item.calorie),
            reason: item.reason,
            score: extractNumber(item.score)
        }));

        const combinedTitle = safeList.map((item, idx) => `${idx+1}. ${item.menuName}`).join(' / ');
        const combinedReason = safeList.map((item, idx) => 
            `[${idx+1}ìœ„] ${item.menuName} (${item.calories}kcal)\nğŸ‘‰ ${item.reason}`
        ).join('\n\n');

        res.status(200).json({
            menuName: combinedTitle,
            calories: safeList[0].calories,
            reason: combinedReason
        });
    } else {
        res.status(200).json({ menuName: "ì¶”ì²œ ë¶ˆê°€", calories: 0, reason: "ì¡°ê±´ì— ë§ëŠ” ë©”ë‰´ê°€ ì—†ìŠµë‹ˆë‹¤." });
    }

  } catch (error) {
    console.error('âŒ Recommendation Error:', error.message);
    res.status(500).json({ error: 'Python Server connection failed' });
  }
});
